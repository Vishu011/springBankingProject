<div class="withdraw-container">
  <h2>Withdraw Funds</h2>

  <div *ngIf="loadingAccounts" class="loading-message">Loading your accounts...</div>
  <div *ngIf="errorMessage" class="message error-message">{{ errorMessage }}</div>
  <div *ngIf="successMessage" class="message success-message">{{ successMessage }}</div>

  <div *ngIf="!loadingAccounts && accounts.length > 0" class="withdraw-form-section">
    <form (ngSubmit)="onSubmit()" #formRef="ngForm">
      <div class="form-group">
        <label for="accountId">Select Account:</label>
        <select id="accountId" name="accountId" [(ngModel)]="withdrawForm.accountId" required>
          <option *ngFor="let account of accounts" [value]="account.accountId">
            {{ account.accountNumber }} ({{ account.accountType }} - Current Balance: {{ account.balance |
            currency:'INR':'symbol':'1.2-2' }})
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="amount">Amount (INR):</label>
        <input type="number" id="amount" name="amount" [(ngModel)]="withdrawForm.amount" required min="0.01"
          step="0.01">
      </div>

      <div class="form-group">
        <label for="otpCode">Enter OTP:</label>
        <div class="otp-row">
          <input
            type="text"
            id="otpCode"
            name="otpCode"
            [(ngModel)]="withdrawForm.otpCode"
            required
            maxlength="6"
            pattern="[0-9]{6}"
            placeholder="6-digit code" />
          <button type="button" (click)="generateOtp()" class="generate-otp-button">Generate OTP</button>
        </div>
        <small class="help-text">A 6-digit OTP will be sent to your registered email.</small>
      </div>

      <button type="submit" [disabled]="!formRef.valid" class="withdraw-button">Withdraw</button>
    </form>
  </div>

  <div *ngIf="!loadingAccounts && accounts.length === 0" class="no-accounts-message">
    <p>You need an active account to withdraw funds from.</p>
    <a routerLink="/accounts" class="create-account-link">Go to Accounts</a>
  </div>
</div>
