<div class="page fade-in">
  <!-- Masthead -->
  <header class="masthead surface shadow-1 rounded-xl mb-4">
    <div class="masthead-left">
      <div class="icon-badge">
        <i class="fa-solid fa-shield-halved"></i>
      </div>
      <div>
        <h2 class="title">Admin Dashboard</h2>
        <p class="subtitle">KYC Verification and Administrative Operations</p>
      </div>
    </div>
    <div class="masthead-actions">
      <button (click)="loadPendingUsers()" class="btn btn-outline-primary" [disabled]="loading">
        <i class="fa-solid fa-rotate me-2" [class.fa-spin]="loading"></i>
        {{ loading ? 'Loading...' : 'Refresh' }}
      </button>
      <button (click)="logout()" class="btn btn-outline-danger">
        <i class="fa-solid fa-right-from-bracket me-2"></i>
        Logout
      </button>
    </div>
  </header>

  <app-agent-panel></app-agent-panel>

  <!-- Stats -->
  <section class="stats-grid mb-4">
    <!-- Pending KYC (dynamic) -->
    <div class="stat-card span-3 surface shadow-1 rounded-xl">
      <div class="stat-header">
        <span class="label">Pending KYC</span>
        <i class="fa-solid fa-clock-rotate-left"></i>
      </div>
      <div class="stat-value">
        <span class="value">{{ pendingUsers?.length || 0 }}</span>
        <span class="chip chip-warn">queue</span>
      </div>
      <div class="stat-foot muted">Awaiting verification</div>
    </div>

    <!-- System Health (static visual) -->
    <div class="stat-card span-3 surface shadow-1 rounded-xl">
      <div class="stat-header">
        <span class="label">System Health</span>
        <i class="fa-solid fa-heart-pulse"></i>
      </div>
      <div class="stat-value">
        <span class="value text-success">99.9%</span>
        <span class="chip chip-ok">healthy</span>
      </div>
      <div class="stat-foot muted">APIs operational</div>
    </div>

    <!-- Review Speed (static visual) -->
    <div class="stat-card span-3 surface shadow-1 rounded-xl">
      <div class="stat-header">
        <span class="label">Avg. Review Time</span>
        <i class="fa-solid fa-gauge-high"></i>
      </div>
      <div class="stat-value">
        <span class="value">2.4m</span>
        <span class="chip chip-info">SLA</span>
      </div>
      <div class="stat-foot muted">Last 24 hours</div>
    </div>

  </section>

  <!-- Feature Navigation -->
  <section class="feature-grid mb-4">
    <a routerLink="/loan-management" class="feature-tile surface shadow-1 rounded-xl">
      <div class="tile-icon bg-grad-blue">
        <i class="fa-solid fa-file-invoice-dollar"></i>
      </div>
      <div class="tile-body">
        <h5>Manage Loans</h5>
        <p class="muted">Loan applications & approvals</p>
      </div>
      <i class="fa-solid fa-arrow-right-long tile-caret"></i>
    </a>

    <a routerLink="/account-management" class="feature-tile surface shadow-1 rounded-xl">
      <div class="tile-icon bg-grad-green">
        <i class="fa-solid fa-university"></i>
      </div>
      <div class="tile-body">
        <h5>Manage Accounts</h5>
        <p class="muted">User accounts & settings</p>
      </div>
      <i class="fa-solid fa-arrow-right-long tile-caret"></i>
    </a>

    <a routerLink="/user-management" class="feature-tile surface shadow-1 rounded-xl">
      <div class="tile-icon bg-grad-cyan">
        <i class="fa-solid fa-users-gear"></i>
      </div>
      <div class="tile-body">
        <h5>Manage Users</h5>
        <p class="muted">User profiles & roles</p>
      </div>
      <i class="fa-solid fa-arrow-right-long tile-caret"></i>
    </a>

    <a routerLink="/kyc-management" class="feature-tile surface shadow-1 rounded-xl">
      <div class="tile-icon bg-grad-indigo">
        <i class="fa-solid fa-shield-halved"></i>
      </div>
      <div class="tile-body">
        <h5>Manage KYC</h5>
        <p class="muted">KYC verification center</p>
      </div>
      <i class="fa-solid fa-arrow-right-long tile-caret"></i>
    </a>

    <a routerLink="/salary-applications" class="feature-tile surface shadow-1 rounded-xl">
      <div class="tile-icon bg-grad-amber">
        <i class="fa-solid fa-briefcase"></i>
      </div>
      <div class="tile-body">
        <h5>Salary Applications</h5>
        <p class="muted">Review corporate account requests</p>
      </div>
      <i class="fa-solid fa-arrow-right-long tile-caret"></i>
    </a>

    <a routerLink="/card-applications" class="feature-tile surface shadow-1 rounded-xl">
      <div class="tile-icon bg-grad-slate">
        <i class="fa-solid fa-credit-card"></i>
      </div>
      <div class="tile-body">
        <h5>Card Applications</h5>
        <p class="muted">Approve credit/debit card requests</p>
      </div>
      <i class="fa-solid fa-arrow-right-long tile-caret"></i>
    </a>

    <a routerLink="/self-service-requests" class="feature-tile surface shadow-1 rounded-xl">
      <div class="tile-icon bg-grad-violet">
        <i class="fa-solid fa-user-pen"></i>
      </div>
      <div class="tile-body">
        <h5>User Profile Requests</h5>
        <p class="muted">Review name/DOB/address changes</p>
      </div>
      <i class="fa-solid fa-arrow-right-long tile-caret"></i>
    </a>
  </section>

  <!-- Alerts -->
  <section class="mb-3" *ngIf="errorMessage || successMessage">
    <div *ngIf="errorMessage" class="alert alert-danger d-flex align-items-start gap-2">
      <i class="fa-solid fa-triangle-exclamation mt-1"></i>
      <div class="flex-1">
        {{ errorMessage }}
      </div>
      <button type="button" class="icon-btn ms-auto" (click)="clearMessages()" aria-label="Close alert">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <div *ngIf="successMessage" class="alert alert-success d-flex align-items-start gap-2">
      <i class="fa-solid fa-circle-check mt-1"></i>
      <div class="flex-1">
        {{ successMessage }}
      </div>
      <button type="button" class="icon-btn ms-auto" (click)="clearMessages()" aria-label="Close alert">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
  </section>

  <!-- Loading Skeleton -->
  <section *ngIf="loading" class="surface shadow-1 rounded-xl p-4 mb-4">
    <div class="skeleton-row">
      <div class="shimmer sk-bar"></div>
      <div class="shimmer sk-bar"></div>
      <div class="shimmer sk-bar"></div>
    </div>
    <div class="skeleton-table mt-3">
      <div class="shimmer sk-row"></div>
      <div class="shimmer sk-row"></div>
      <div class="shimmer sk-row"></div>
      <div class="shimmer sk-row"></div>
    </div>
  </section>

  <!-- KYC Applications Table -->
  <section *ngIf="!loading && pendingUsers.length > 0" class="surface shadow-1 rounded-xl overflow-hidden">
    <div class="card-header bg-none border-0 px-4 py-3">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
          <i class="fa-solid fa-clock me-2"></i>
          Pending KYC Applications
        </h5>
        <span class="badge bg-warning text-dark fs-6">
          {{ pendingUsers.length }} pending
        </span>
      </div>
    </div>

    <div class="px-4 pb-3">
      <div class="alert alert-info m-0">
        <i class="fa-solid fa-circle-info me-2"></i>
        <strong>Review carefully:</strong> Approving/rejecting will notify the user and update account permissions.
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            <th scope="col"><i class="fa-solid fa-user me-1"></i> User</th>
            <th scope="col"><i class="fa-solid fa-envelope me-1"></i> Contact</th>
            <th scope="col"><i class="fa-solid fa-id-card me-1"></i> Full Name</th>
            <th scope="col"><i class="fa-solid fa-flag me-1"></i> Status</th>
            <th scope="col" class="text-center"><i class="fa-solid fa-sliders me-1"></i> Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of pendingUsers; trackBy: trackbyUserId" class="fade-in">
            <td>
              <div class="d-flex align-items-center">
                <div class="avatar">
                  {{ user.username.charAt(0).toUpperCase() }}
                </div>
                <div>
                  <strong>{{ user.username }}</strong><br>
                  <small class="text-muted">ID: {{ user.userId | slice:0:8 }}...</small>
                </div>
              </div>
            </td>
            <td>
              <a [href]="'mailto:' + user.email" class="text-decoration-none">
                {{ user.email }}
              </a>
            </td>
            <td>
              <strong>{{ user.firstName }} {{ user.lastName }}</strong>
            </td>
            <td>
              <span [ngClass]="getKycStatusClass(user.kycStatus)">
                <i class="fa-solid fa-clock me-1"></i>
                {{ user.kycStatus }}
              </span>
            </td>
            <td class="text-center">
              <div class="btn-group" role="group">
                <button (click)="approveKyc(user.userId)" class="btn btn-success btn-sm" title="Approve KYC">
                  <i class="fa-solid fa-check me-1"></i>Approve
                </button>
                <button (click)="rejectKyc(user.userId)" class="btn btn-danger btn-sm" title="Reject KYC">
                  <i class="fa-solid fa-xmark me-1"></i>Reject
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- No Pending Applications -->
  <section *ngIf="!loading && pendingUsers.length === 0 && !successMessage" class="surface shadow-1 rounded-xl text-center p-5">
    <div class="mb-3">
      <i class="fa-solid fa-circle-check text-success" style="font-size: 3rem;"></i>
    </div>
    <h3 class="mb-2">All Clear!</h3>
    <p class="muted mb-4">No pending KYC applications at the moment.</p>
    <button (click)="loadPendingUsers()" class="btn btn-outline-primary">
      <i class="fa-solid fa-rotate me-2"></i> Check for Updates
    </button>
  </section>
</div>
